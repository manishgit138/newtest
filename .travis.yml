dist: bionic
services:
    - docker

script:
  - sudo apt install postgresql postgresql-contrib -y
  - systemctl enable postgresql
  - sudo -u postgres createuser concourse
  - sudo -u postgres createdb --owner=concourse atc
  #- wget https://concourse-ci.org/docker-compose.yml
  #- docker-compose up -d
  - wget https://github.com/concourse/concourse/releases/download/v6.7.2/concourse-6.7.2-linux-amd64.tgz
  - tar -xzf concourse-6.7.2-linux-amd64.tgz -C /usr/local/bin
  - sudo mkdir /etc/concourse
  - ssh-keygen -t rsa -q -N '' -f /etc/concourse/tsa_host_key
  - ssh-keygen -t rsa -q -N '' -f /etc/concourse/worker_key
  - ssh-keygen -t rsa -q -N '' -f /etc/concourse/session_signing_key
  - sudo cp /etc/concourse/worker_key.pub /etc/concourse/authorized_worker_keys
  - EXT_IP=$(curl -s https://ip.ruan.dev)
  - echo $EXT_IP
  - ls
  - cd concourse
  - cd fly-assets
  - ls
  - tar -xzf fly-linux-amd64.tgz
  - sudo cp fly /usr/local/bin/
  - fly
